<!DOCTYPE html>
<html>
    <head>
        <link href="main.css" rel="stylesheet" type="text/css">
        <script>
            // Global array with line data
            var lineIndex = [];
            // Global array with intersection data
            var intersectionIndex = [];

            //Draw the edges of the canvas as lines
            function drawEdges()
            {
                // Draw Edges
                var canvas = document.getElementById("myCanvas");
                canvas.width = canvas.width;
                var ctx = canvas.getContext("2d");
                ctx.beginPath();
                ctx.moveTo(0, 0);
                ctx.lineTo(0, 400);
                ctx.lineTo(400, 400);
                ctx.lineTo(400, 0);
                ctx.lineTo(0, 0);
                ctx.stroke();

                // Push edgeLines to the line Index
                /*lineIndex.push([0,0,0,400]); //unsure how to handle 0 slope
                lineIndex.push([0,400,400,400,0,find_yIntercept(0,400,0)]);
                lineIndex.push([400,400,400,0]); // unsure how to handle 0 slope
                lineIndex.push([400,0,0,0,0,find_yIntercept(400,0,0)]);*/
                
                // Make Variable Coordinates
                // x,y is current mouse location
                // xi, yi is start location
                // xe, ye is end location
                var x, y, xi, yi, xe, ye;
                var size = 0;

                // line Index layout
                // 0 [xi,yi,xe,ye,slope,yInt]
                // 1 [xi,yi,xe,ye,slope,yInt]
                // 2 [xi,yi,xe,ye,slope,yInt]

                // Track variable coordinates on mousemove relevant to canvas
                canvas.onmousemove = function(event) {
                    x = event.pageX - this.offsetLeft;
                    y = event.pageY - this.offsetTop;
                }

                // function that gets called on mousedown in canvas
                canvas.addEventListener("mousedown", function(){
                    ctx.beginPath();
                    ctx.moveTo(x,y);
                    xi = x;
                    yi = y;
                });

                // function that gets called on mouseup in canvas
                canvas.addEventListener("mouseup", function(){
                    ctx.lineTo(x,y);
                    ctx.stroke();
                    xe = x;
                    ye = y;
                    var slope = findSlope(xi,yi,xe,ye);
                    lineIndex.push([xi,yi,xe,ye,slope,find_yIntercept(xi,yi,slope)]);
                    console.log("line " + size + " added");
                    size++;
                });
            }

            // function finds and returns the slope of the line segment
            function findSlope(xi, yi, xe, ye){
                var slope = ((ye - yi)/(xe -xi));
                return slope;
            }

            function find_yIntercept(xi,yi,slope){
                var yIntercept = (yi - (slope * xi));
                return yIntercept;
            }

            function findTriangles(){
                intersectionIndex.splice(0,intersectionIndex.length);
                // finds intersections and stores them
                for (var i = 0; i < lineIndex.length; i++){
                    for(var j = i+1; j < lineIndex.length; j++){
                        var mutualX = ((lineIndex[j][5] - lineIndex[i][5])/(lineIndex[i][4] - lineIndex[j][4]));
                        // lines if not segments would meet at mutualX
                        // mutualX is yint2 - yint1 divided by slope1 - slope2
                        var xbig;
                        var xsmall;
                        var xsame = false;

                        // this sorts out what is the range of the acceptable x values
                        if(lineIndex[i][0] > lineIndex[i][2]){
                            xbig = lineIndex[i][0];
                            xsmall = lineIndex[i][2];
                        } else if (lineIndex[i][0] == lineIndex[i][2]) {
                            xsame = true;
                        } else {
                            xbig = lineIndex[i][2];
                            xsmall = lineIndex[i][0];
                        }

                        // this compares the intersection to make sure it's part of the line segements
                        if(mutualX >= xsmall && mutualX <= xbig){
                            // push intersections into an array
                            intersectionIndex.push([i,j]);
                        }
                    }
                }

                // remove duplicates in intersectionIndex
                for (var i = 0; i < intersectionIndex.length; i++){
                    for(var j = 0; j < intersectionIndex.length; j++){
                        if(intersectionIndex[i][0] == intersectionIndex[j][0]
                        && intersectionIndex[i][1] == intersectionIndex[j][1]
                        && i != j){
                            intersectionIndex.splice(j, 1);
                        }
                    }
                }

                var totalTriangles = 0;
                var tempContainer = [];

                for (var i = 0; i < intersectionIndex.length; i++){
                    for (var j = 0; j < intersectionIndex.length; j++){
                        if(intersectionIndex[i][0] == intersectionIndex[j][1] && i != j){
                            tempContainer.push(intersectionIndex[j][0]);
                        }
                        if(intersectionIndex[i][1] == intersectionIndex[j][1] && i != j){
                            tempContainer.push(intersectionIndex[j][0]);
                        }
                    }
                    // find pairs and add to triangle count then clear container
                    for (var k = 0; k < tempContainer.length; k++){
                        for(var l = 0; l < tempContainer.length; l++){
                            if (tempContainer[k] == tempContainer[l] && k != l){
                                console.log("var k = " + tempContainer[k]);
                                console.log("var l = " + tempContainer[l]);
                                totalTriangles++;
                            }
                        }
                    }
                    console.log("tempContainer");
                    console.log(JSON.stringify(tempContainer));
                    tempContainer = [];
                }


                console.log("totalTriangles = " + totalTriangles);
                console.log("intersection index:");
                console.log(JSON.stringify(intersectionIndex));
            }
        </script>
    </head>
    <body onload="drawEdges();">
        <!-- Navigation Bar On Top -->
        <div class="topnav">
            <a href="/">Home</a>
            <a href="/page2">Page 2</a>
            <a class="active" href="/page3">Page 3</a>
        </div>
        <h1>Draw lines to calculate triangles</h1>
        <!-- Blank Canvas -->
        <div class="boxCanvas">
            <canvas id="myCanvas" width="400" height="400"></canvas>
        </div>
        <button onclick="findTriangles();">Find triangles</button>
    </body>
</html>